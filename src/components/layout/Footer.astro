---
// Agracom Internacional S.A. - Footer Component
// Footer principal con navegación, contactos y información corporativa

import type { Locale, Region } from '../../types/global';
import { createTranslator, getLocalizedURL } from '../../utils/i18n';

export interface Props {
  lang: Locale;
  currentRegion?: Region;
  showNewsletter?: boolean;
  showSocial?: boolean;
  class?: string;
}

const {
  lang,
  currentRegion,
  showNewsletter = false,
  showSocial = true,
  class: className = ''
} = Astro.props;

// Load translations
const { common, regions } = await createTranslator(lang);

// Navigation sections
const navigationSections = [
  {
    title: await common('navigation.products'),
    links: [
      { 
        text: lang === 'es' ? 'Lupinos Premium' : 'Premium Lupins',
        href: '#productos' 
      },
      { 
        text: lang === 'es' ? 'Cerezas Santina' : 'Santina Cherries',
        href: '#productos' 
      },
      { 
        text: await common('navigation.certifications'),
        href: '#certificaciones' 
      }
    ]
  },
  {
    title: await common('footer.quick_links'),
    links: [
      { 
        text: await common('navigation.about'),
        href: getLocalizedURL('/nosotros', lang)
      },
      { 
        text: await common('navigation.regions'),
        href: '#regiones' 
      },
      { 
        text: await common('navigation.contact'),
        href: '#contacto' 
      }
    ]
  }
];

// Regional contacts
const regionalContacts = [
  {
    region: 'us-east',
    name: 'Cristián Rodríguez',
    title: lang === 'es' ? 'Ejecutivo Costa Este EE.UU.' : 'US East Coast Executive',
    email: 'cristian@agracom.cl',
    phone: '+56 9 1234 5678'
  },
  {
    region: 'mediterranean',
    name: 'Pedro Mendive',
    title: lang === 'es' ? 'Ejecutivo Mediterráneo' : 'Mediterranean Executive',
    email: 'pedro@agracom.cl',
    phone: '+56 9 8765 4321'
  },
  {
    region: 'middle-east',
    name: 'Cristián Rodríguez',
    title: lang === 'es' ? 'Ejecutivo Medio Oriente' : 'Middle East Executive',
    email: 'cristian@agracom.cl',
    phone: '+56 9 1234 5678'
  }
];

// Social media links (when available)
const socialLinks = [
  {
    name: 'LinkedIn',
    href: 'https://www.linkedin.com/company/agracom-internacional',
    icon: 'linkedin'
  },
  {
    name: 'Email',
    href: 'mailto:info@agracom.cl',
    icon: 'email'
  }
];

// Current year for copyright
const currentYear = new Date().getFullYear();
---

<footer 
  class={`bg-neutral-900 text-white relative overflow-hidden ${className}`}
  role="contentinfo"
>
  <!-- Background Pattern -->
  <div class="absolute inset-0 opacity-5">
    <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KPGcgZmlsbD0iI0ZGQTAwMCIgZmlsbC1vcGFjaXR5PSIwLjEiPgo8Y2lyY2xlIGN4PSIyMCIgY3k9IjIwIiByPSIxIi8+CjwvZz4KPC9nPgo8L3N2Zz4=')] repeat"></div>
  </div>

  <div class="container mx-auto px-4 relative z-10">
    
    <!-- Main Footer Content -->
    <div class="py-12">
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
        
        <!-- Brand Section -->
        <div class="lg:col-span-1 space-y-6">
          <!-- Logo and Brand -->
          <div class="space-y-4">
            <a 
              href={getLocalizedURL('/', lang)}
              class="inline-flex items-center space-x-4 group focus:outline-none focus:ring-2 focus:ring-accent rounded-lg p-1"
              aria-label={`${lang === 'es' ? 'Ir al inicio' : 'Go to homepage'}`}
            >
              <!-- AgraCom Official Logo -->
              <div class="w-16 h-16 sm:w-18 sm:h-18 flex items-center justify-center group-hover:scale-105 transition-transform">
                <img 
                  src="/images/agracom-logo.svg" 
                  alt="AgraCom Internacional Logo" 
                  class="w-full h-full object-contain filter brightness-0 invert"
                  loading="lazy"
                />
              </div>
              <div>
                <h2 class="text-2xl font-bold text-white group-hover:text-accent transition-colors">
                  Agracom Internacional
                </h2>
              </div>
            </a>
            
            <!-- Tagline -->
            <p class="text-neutral-300 leading-relaxed">
              {await common('footer.tagline')}
            </p>
            
            <!-- Quality badges -->
            <div class="flex flex-wrap gap-2">
              <span class="certification-badge certification-badge--kosher text-xs">Kosher</span>
              <span class="certification-badge certification-badge--halal text-xs">Halal</span>
              <span class="certification-badge certification-badge--sag text-xs">SAG</span>
            </div>
          </div>

          <!-- Social Links -->
          {showSocial && (
            <div class="space-y-3">
              <h3 class="text-sm font-semibold text-neutral-200 uppercase tracking-wide">
                {await common('footer.follow_us')}
              </h3>
              <div class="flex space-x-4">
                {socialLinks.map((social) => (
                  <a
                    href={social.href}
                    class="w-10 h-10 bg-neutral-800 hover:bg-primary rounded-lg flex items-center justify-center transition-colors group"
                    aria-label={`${social.name} - ${lang === 'es' ? 'Abrir en nueva ventana' : 'Open in new window'}`}
                    target={social.href.startsWith('http') ? '_blank' : undefined}
                    rel={social.href.startsWith('http') ? 'noopener noreferrer' : undefined}
                  >
                    {social.icon === 'linkedin' && (
                      <svg class="w-5 h-5 text-neutral-300 group-hover:text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                      </svg>
                    )}
                    {social.icon === 'email' && (
                      <svg class="w-5 h-5 text-neutral-300 group-hover:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                      </svg>
                    )}
                  </a>
                ))}
              </div>
            </div>
          )}
        </div>

        <!-- Navigation Sections -->
        {navigationSections.map((section) => (
          <div class="space-y-6">
            <h3 class="text-lg font-semibold text-white">
              {section.title}
            </h3>
            <ul class="space-y-3">
              {section.links.map((link) => (
                <li>
                  <a
                    href={link.href}
                    class="text-neutral-300 hover:text-white transition-colors duration-200 block py-1"
                  >
                    {link.text}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        ))}

        <!-- Contact Information -->
        <div class="space-y-6">
          <h3 class="text-lg font-semibold text-white">
            {await common('footer.contact_title')}
          </h3>
          
          <!-- Main Contact -->
          <div class="space-y-3">
            <div class="space-y-1">
              <h4 class="text-sm font-medium text-neutral-200">
                {lang === 'es' ? 'Oficina Principal' : 'Main Office'}
              </h4>
              <div class="text-neutral-300 text-sm space-y-1">
                <p>info@agracom.cl</p>
                <p>+56 2 1234 5678</p>
                <p>Santiago, Chile</p>
              </div>
            </div>
          </div>

          <!-- Regional Contacts -->
          {currentRegion && (
            <div class="bg-neutral-800 rounded-lg p-4 space-y-3">
              <h4 class="text-sm font-medium text-accent">
                {lang === 'es' ? 'Su Ejecutivo Regional' : 'Your Regional Executive'}
              </h4>
              {regionalContacts
                .filter(contact => contact.region === currentRegion)
                .map((contact) => (
                  <div class="space-y-1">
                    <p class="text-white font-medium">{contact.name}</p>
                    <p class="text-neutral-300 text-sm">{contact.title}</p>
                    <div class="text-neutral-300 text-sm space-y-1">
                      <p>{contact.email}</p>
                      <p>{contact.phone}</p>
                    </div>
                  </div>
                ))
              }
            </div>
          )}

          <!-- Business Hours -->
          <div class="text-neutral-300 text-sm">
            <p class="font-medium text-neutral-200 mb-1">
              {lang === 'es' ? 'Horario de Atención' : 'Business Hours'}
            </p>
            <p>
              {lang === 'es' ? 'Lunes a Viernes' : 'Monday to Friday'}<br/>
              9:00 - 18:00 (CLT)
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Newsletter Section (Optional) -->
    {showNewsletter && (
      <div class="border-t border-neutral-800 py-8">
        <div class="max-w-2xl mx-auto text-center space-y-4">
          <h3 class="text-xl font-semibold text-white">
            {lang === 'es' ? 'Mantente Informado' : 'Stay Informed'}
          </h3>
          <p class="text-neutral-300">
            {lang === 'es' 
              ? 'Recibe actualizaciones sobre productos y mercados agrícolas'
              : 'Get updates on products and agricultural markets'
            }
          </p>
          <form class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
            <input
              type="email"
              placeholder={lang === 'es' ? 'Tu email' : 'Your email'}
              class="flex-1 px-4 py-3 bg-neutral-800 text-white rounded-lg border border-neutral-700 focus:border-primary focus:ring-1 focus:ring-primary focus:outline-none"
              required
            />
            <button
              type="submit"
              class="btn btn-primary px-6 py-3 whitespace-nowrap"
            >
              {lang === 'es' ? 'Suscribirse' : 'Subscribe'}
            </button>
          </form>
        </div>
      </div>
    )}

    <!-- Bottom Bar -->
    <div class="border-t border-neutral-800 py-6">
      <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
        
        <!-- Copyright -->
        <div class="text-neutral-400 text-sm text-center md:text-left">
          <p>
            © {currentYear} Agracom Internacional S.A. 
            {lang === 'es' ? 'Todos los derechos reservados.' : 'All rights reserved.'}
          </p>
        </div>

        <!-- Language Switcher -->
        <div class="flex items-center space-x-4">
          <div class="flex items-center space-x-2 bg-neutral-800 rounded-lg p-1">
            <a 
              href={lang === 'es' ? '/' : '/'}
              class={`px-3 py-1 rounded-md text-sm font-semibold transition-all ${
                lang === 'es' 
                  ? 'bg-primary text-white' 
                  : 'text-neutral-400 hover:text-white'
              }`}
              hreflang="es"
              aria-label={`${lang === 'es' ? 'Página en español (actual)' : 'Cambiar a español'}`}
            >
              ES
            </a>
            <span class="text-neutral-600">|</span>
            <a 
              href={lang === 'es' ? '/en' : '/'}
              class={`px-3 py-1 rounded-md text-sm font-semibold transition-all ${
                lang === 'en' 
                  ? 'bg-primary text-white' 
                  : 'text-neutral-400 hover:text-white'
              }`}
              hreflang={lang === 'es' ? 'en' : 'es'}
              aria-label={`${lang === 'es' ? 'Cambiar a inglés' : 'Switch to English'}`}
            >
              EN
            </a>
          </div>
        </div>

        <!-- Legal Links -->
        <div class="flex items-center space-x-4 text-sm text-neutral-400">
          <a href="#" class="hover:text-white transition-colors">
            {lang === 'es' ? 'Política de Privacidad' : 'Privacy Policy'}
          </a>
          <span>•</span>
          <a href="#" class="hover:text-white transition-colors">
            {lang === 'es' ? 'Términos de Uso' : 'Terms of Use'}
          </a>
        </div>
      </div>
    </div>

    <!-- "Made in Chile" Badge -->
    <div class="text-center pb-6">
      <div class="inline-flex items-center space-x-2 text-neutral-500 text-sm">
        <span class="text-lg" title={lang === 'es' ? 'Hecho en Chile' : 'Made in Chile'}>🇨🇱</span>
        <span>{await common('footer.made_in_chile')}</span>
      </div>
    </div>
  </div>

  <!-- Scroll to Top Button -->
  <button
    type="button"
    class="fixed bottom-6 right-6 w-12 h-12 bg-primary hover:bg-primary hover:bg-opacity-90 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 opacity-0 invisible z-50"
    id="scroll-to-top"
    aria-label={lang === 'es' ? 'Volver arriba' : 'Scroll to top'}
  >
    <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
    </svg>
  </button>
</footer>

<!-- Footer JavaScript -->
<script define:vars={{ currentLang: lang }}>
  // Scroll to top functionality
  document.addEventListener('DOMContentLoaded', function() {
    const scrollButton = document.getElementById('scroll-to-top');
    
    if (scrollButton) {
      // Show/hide scroll button based on scroll position
      window.addEventListener('scroll', function() {
        if (window.pageYOffset > 300) {
          scrollButton.style.opacity = '1';
          scrollButton.style.visibility = 'visible';
        } else {
          scrollButton.style.opacity = '0';
          scrollButton.style.visibility = 'invisible';
        }
      });
      
      // Scroll to top when clicked
      scrollButton.addEventListener('click', function() {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
    }
  });

  // Newsletter form handling (if enabled)
  const newsletterForm = document.querySelector('footer form');
  if (newsletterForm) {
    newsletterForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const emailInput = this.querySelector('input[type="email"]');
      const email = emailInput ? emailInput.value : '';
      
      // Add your newsletter subscription logic here
      console.log('Newsletter subscription:', email);
      
      // Show success message
      const button = this.querySelector('button');
      if (button) {
        const originalText = button.textContent;
        button.textContent = currentLang === 'es' ? '¡Gracias!' : 'Thanks!';
        button.disabled = true;
        
        setTimeout(() => {
          button.textContent = originalText;
          button.disabled = false;
          this.reset();
        }, 2000);
      }
    });
  }
</script>

<style>
  /* Smooth scroll behavior */
  html {
    scroll-behavior: smooth;
  }

  /* Enhanced hover effects for links */
  footer a {
    position: relative;
  }

  footer a:not(.btn):hover::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 1px;
    background-color: currentColor;
    animation: slideIn 0.3s ease-out;
  }

  @keyframes slideIn {
    from {
      width: 0;
    }
    to {
      width: 100%;
    }
  }

  /* Scroll to top button animation */
  #scroll-to-top {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  #scroll-to-top:hover {
    transform: translateY(-2px);
  }

  /* Focus styles for accessibility */
  footer button:focus,
  footer a:focus {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  /* Newsletter form enhancements */
  footer form input:focus {
    box-shadow: 0 0 0 3px rgba(21, 101, 192, 0.1);
  }

  /* Responsive grid adjustments */
  @media (max-width: 1024px) {
    .grid.lg\\:grid-cols-4 {
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }
  }

  @media (max-width: 640px) {
    .grid.lg\\:grid-cols-4 {
      grid-template-columns: 1fr;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    footer {
      border-top: 3px solid #fff;
    }
    
    .certification-badge {
      border: 2px solid currentColor;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
    
    #scroll-to-top:hover {
      transform: none;
    }
    
    @keyframes slideIn {
      from, to {
        width: 100%;
      }
    }
  }
</style>
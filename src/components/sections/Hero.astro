---
// Agracom Internacional S.A. - Hero Section Component
// Sección principal con propuesta de valor, CTAs y imagen hero

import type { Locale, Region, CTAButton, ImageAsset } from '../../types/global';
import { createTranslator, getAssetURL } from '../../utils/i18n';

export interface Props {
  title?: string;
  subtitle?: string;
  description?: string;
  bgImage?: ImageAsset;
  primaryCTA?: CTAButton;
  secondaryCTA?: CTAButton;
  certificationBadges?: boolean;
  showStats?: boolean;
  region?: Region;
  lang: Locale;
  class?: string;
}

const {
  title,
  subtitle,
  description,
  bgImage,
  primaryCTA,
  // secondaryCTA,
  certificationBadges = true,
  showStats = true,
  region,
  lang,
  class: className = ''
} = Astro.props;

// Load translations
const { hero, common } = await createTranslator(lang);

// Default content from translations if not provided
const heroTitle = title || await hero('title');
const heroSubtitle = subtitle || await hero('subtitle');
const heroDescription = description || await hero('description');

// Default CTAs if not provided
const defaultPrimaryCTA: CTAButton = {
  text: primaryCTA?.text || await common('cta.inquire'),
  href: primaryCTA?.href || '#contacto',
  variant: primaryCTA?.variant || 'primary'
};

// Nota: CTA secundario original (descarga) no se usa en Hero; se reemplaza por explorar productos

// Stats data
const stats = [
  {
    value: '270+',
    label: lang === 'es' ? 'Embarques exitosos' : 'Successful shipments'
  },
  {
    value: '17',
    label: lang === 'es' ? 'Países' : 'Countries'
  },
  {
    value: '20+',
    label: lang === 'es' ? 'Años de experiencia' : 'Years of experience'
  }
];

// Certifications
const certifications = [
  { name: 'Kosher', class: 'certification-badge--kosher' },
  { name: 'Halal', class: 'certification-badge--halal' },
  { name: 'FDA', class: 'certification-badge--fda' }
];

// Default vertical hero image optimized for design (WebP)
const defaultHeroImage: ImageAsset = {
  src: getAssetURL('/images/agracom_herosection_bodegon.webp?v=1'),
  alt: lang === 'es'
    ? 'Bodegón vertical de productos Agracom: lupinos, pasas y nueces'
    : 'Vertical still life of Agracom products: lupins, raisins and walnuts',
  width: 1200,
  height: 1800
};

// CTA secundario removido según estrategia de foco en acción principal
---

<section 
  id="hero"
  class={`section--hero bg-gradient-to-br from-primary/5 to-secondary/5 relative overflow-hidden mt-6 md:mt-8 lg:mt-10 ${className}`}
  role="banner"
  aria-label={lang === 'es' ? 'Sección principal' : 'Main hero section'}
>
  <!-- Background Pattern (Optional) -->
  <div class="absolute inset-0 opacity-5">
    <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KPGcgZmlsbD0iIzE1NjVDMCIgZmlsbC1vcGFjaXR5PSIwLjEiPgo8Y2lyY2xlIGN4PSIzMCIgY3k9IjMwIiByPSIyIi8+CjwvZz4KPC9nPgo8L3N2Zz4=')] repeat"></div>
  </div>

  <div class="container relative z-10">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-y-10 gap-x-12 items-start">
      <!-- Content Section -->
      <div class="lg:col-span-7 space-y-8 flex flex-col justify-start">
        <!-- Main Content -->
        <div class="space-y-6">
          <!-- Title -->
          <h1 
            class="text-h1 font-bold text-neutral-900 leading-tight tracking-tight max-w-3xl animate-fade-in"
            style="animation-delay: 0.1s"
            data-hero-title
          >
            {heroTitle}
          </h1>
          
          <!-- Subtitle -->
          <p 
            class="text-xl text-neutral-700 max-w-2xl leading-relaxed animate-fade-in"
            style="animation-delay: 0.2s"
             id="hero-subtitle"
          >
            {heroSubtitle}
          </p>

          <!-- Description (Optional) -->
          {heroDescription && (
            <p 
              class="text-lg text-neutral-600 max-w-xl animate-fade-in"
              style="animation-delay: 0.3s"
              data-hero-description
            >
              {heroDescription}
            </p>
          )}
          
          <!-- Certification Badges -->
          {certificationBadges && (
            <div 
              class="flex flex-wrap gap-3 animate-fade-in"
              style="animation-delay: 0.4s"
            >
              {certifications.map((cert) => (
                <span 
                  class={`certification-badge ${cert.class}`}
                  role="img"
                  aria-label={`${cert.name} certified`}
                >
                  {cert.name}
                </span>
              ))}
              
              <!-- Success metric badge -->
              <span 
                class="px-3 py-1 bg-accent bg-opacity-20 text-accent-dark rounded-full text-sm font-semibold border border-accent border-opacity-30"
              >
                270+ {lang === 'es' ? 'Embarques Exitosos' : 'Successful Shipments'}
              </span>
            </div>
          )}
        </div>
        
        <!-- CTA principal único -->
        <div 
          class="flex animate-fade-in"
          style="animation-delay: 0.5s"
        >
          <a 
            href={defaultPrimaryCTA.href}
            class={`btn btn-${defaultPrimaryCTA.variant} px-8 py-4 text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300`}
            onclick={`gtag && gtag('event', 'cta_click', { event_label: 'hero_primary', custom_parameter_region: '${region || 'unknown'}' })`}
          >
            {defaultPrimaryCTA.text}
            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>
        </div>

        <!-- Stats ahora se muestran a ancho completo, no dentro de la columna izquierda -->
      </div>
      
      <!-- Image Section -->
      <div 
        class="lg:col-span-5 relative animate-fade-in self-start"
        style="animation-delay: 0.3s"
      >
        <!-- Image Container (vertical-first) -->
        <div class="rounded-2xl shadow-2xl ring-1 ring-neutral-200 overflow-hidden bg-neutral-100 relative flex items-start justify-center w-full lg:max-w-[560px] xl:max-w-[600px] mx-auto">
          <picture class="block w-full">
            <source 
              srcset={`${getAssetURL('/images/agracom_herosection_bodegon.webp?v=1')} 1200w, ${getAssetURL('/images/agracom_herosection_bodegon.webp?v=1')} 800w, ${getAssetURL('/images/agracom_herosection_bodegon.webp?v=1')} 600w`}
              sizes="(min-width: 1280px) 560px, (min-width: 1024px) 520px, 90vw" 
              type="image/webp" 
            />
            <img
              src={(bgImage?.src) || defaultHeroImage.src}
              alt={(bgImage?.alt) || defaultHeroImage.alt}
              width={(bgImage?.width) || defaultHeroImage.width}
              height={(bgImage?.height) || defaultHeroImage.height}
              loading="eager"
              decoding="async"
              fetchpriority="high"
              class="block w-auto h-auto max-h-[72vh] md:max-h-[78vh] object-cover mx-auto hero-zoom"
            />
          </picture>
          
          
        </div>

        
      </div>
    </div>

    <!-- Enhanced Stats Section -->
    {showStats && (
      <div 
        class="mt-16 animate-fade-in"
        style="animation-delay: 0.7s"
      >
        <div class="relative">
          <!-- Background gradient overlay -->
          <div class="absolute inset-0 bg-gradient-to-r from-primary/5 via-secondary/5 to-accent/5 rounded-2xl"></div>
          
          <!-- Stats grid with enhanced design -->
          <div class="relative border border-neutral-200/50 bg-white/80 backdrop-blur-sm rounded-2xl p-8 shadow-lg">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
              {stats.map((stat, index) => (
                <div 
                  class="text-center group relative animate-fade-in"
                  style={`animation-delay: ${0.8 + index * 0.1}s`}
                >
                  <!-- Stat card with hover effects -->
                  <div class="relative p-6 rounded-xl bg-gradient-to-br from-neutral-50 to-neutral-100/50 border border-neutral-200/30 group-hover:border-primary/20 transition-all duration-300 group-hover:shadow-md group-hover:transform group-hover:scale-105">
                    <!-- Icon background -->
                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
                      <div class="w-6 h-6 bg-gradient-to-br from-primary to-secondary rounded-full shadow-sm"></div>
                    </div>
                    
                    <!-- Stat number -->
                    <div 
                      class="text-4xl md:text-5xl lg:text-6xl font-bold bg-gradient-to-br from-primary via-secondary to-accent bg-clip-text text-transparent mb-3 counter leading-none"
                      data-target={stat.value.replace(/\D/g, '')}
                      data-suffix={stat.value.replace(/\d/g, '')}
                    >
                      {stat.value}
                    </div>
                    
                    <!-- Stat label with enhanced typography -->
                    <div class="text-sm md:text-base font-semibold text-neutral-700 uppercase tracking-wide leading-tight">
                      {stat.label}
                    </div>
                    
                    <!-- Subtle accent line -->
                    <div class="mt-3 mx-auto w-12 h-0.5 bg-gradient-to-r from-primary/30 to-secondary/30 rounded-full group-hover:from-primary/60 group-hover:to-secondary/60 transition-all duration-300"></div>
                  </div>
                </div>
              ))}
            </div>
            
            <!-- Trust statement with better positioning -->
            <div class="mt-8 pt-6 border-t border-neutral-200/50 text-center">
              <p class="text-neutral-600 text-sm md:text-base font-medium mb-6">
                {lang === 'es' 
                  ? 'Confianza respaldada por certificaciones internacionales'
                  : 'Trust backed by international certifications'
                }
              </p>
              
              <!-- Enhanced certification icons -->
              <div class="flex justify-center items-center space-x-6">
                <div class="flex items-center justify-center w-10 h-10 bg-amber-50 text-amber-600 rounded-full border border-amber-200/50 shadow-sm">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                  </svg>
                </div>
                
                <div class="flex items-center justify-center w-10 h-10 bg-green-50 text-green-600 rounded-full border border-green-200/50 shadow-sm">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                </div>
                
                <div class="flex items-center justify-center w-10 h-10 bg-blue-50 text-blue-600 rounded-full border border-blue-200/50 shadow-sm">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.73 6.974 6 7.5 6A1.5 1.5 0 019 7.5V8a2 2 0 004 0 2 2 0 011.523-1.943A5.977 5.977 0 0116 10c0 .34-.028.675-.083 1H15a2 2 0 00-2 2v2.197A5.973 5.973 0 0110 16v-2a2 2 0 00-2-2 2 2 0 01-2-2 2 2 0 00-1.668-1.973z" clip-rule="evenodd"/>
                  </svg>
                </div>
                
                <div class="flex items-center justify-center w-10 h-10 bg-purple-50 text-purple-600 rounded-full border border-purple-200/50 shadow-sm">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    )}
  </div>
</section>

<!-- JavaScript for animations and interactions -->
<script>
  // Counter animation for stats
  function animateCounters() {
    const counters = document.querySelectorAll('.counter') as NodeListOf<HTMLElement>;
    
    counters.forEach(counter => {
      const target = parseInt((counter as HTMLElement).dataset.target || '0');
      const suffix = (counter as HTMLElement).dataset.suffix || '';
      const duration = 2000; // 2 seconds
      const increment = target / (duration / 16); // 60fps
      let current = 0;
      
      const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
          current = target;
          clearInterval(timer);
        }
        (counter as HTMLElement).textContent = Math.floor(current) + suffix;
      }, 16);
    });
  }

  // Intersection Observer for animations
  function observeHero() {
    const hero = document.querySelector('section[role="banner"]');
    if (!hero) return;

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          // Trigger counter animation when hero comes into view
          setTimeout(animateCounters, 800);
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.3 });

    observer.observe(hero);
  }

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    observeHero();
  });

  // (Optional) Parallax effect removed to avoid unused function lint errors
</script>

<style>
  /* Custom animations */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fadeIn 0.8s ease-out forwards;
    opacity: 0;
  }

  /* Enhanced button hover effects */
  .btn:hover {
    transform: translateY(-2px);
  }

  .btn:active {
    transform: translateY(0);
  }

  /* Ensure hero takes appropriate height */
  .section--hero { min-height: 78vh; display: flex; align-items: center; }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .section--hero {
      min-height: 70vh;
    }
    
    .hero-container {
      gap: 2rem;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .certification-badge {
      border: 2px solid currentColor;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .animate-fade-in {
      animation: none;
      opacity: 1;
    }
    
    .btn:hover {
      transform: none;
    }
  }

  /* === Hero image subtle zoom loop === */
  @keyframes heroZoomPan {
    /* Inicio del ciclo: aparece sutilmente mientras comienza el acercamiento */
    0%   { transform: translate(var(--pan-x-start, 0), var(--pan-y-start, 0)) scale(var(--scale-start, 1.02)); opacity: 0; }
    3%   { transform: translate(var(--pan-x-start, 0), var(--pan-y-start, 0)) scale(var(--scale-start, 1.02)); opacity: 1; }
    /* Zoom + pan principal */
    70%  { transform: translate(var(--pan-x-end, -2%), var(--pan-y-end, 0)) scale(var(--scale-end, 1.14)); opacity: 1; }
    /* Pausa en máximo zoom (≈2s en ciclo de 16s) */
    90%  { transform: translate(var(--pan-x-end, -2%), var(--pan-y-end, 0)) scale(var(--scale-end, 1.14)); opacity: 1; }
    /* Desvanecer para cerrar el ciclo, sin retroceder zoom */
    100% { transform: translate(var(--pan-x-end, -2%), var(--pan-y-end, 0)) scale(var(--scale-end, 1.14)); opacity: 0; }
  }

  .hero-zoom {
    animation: heroZoomPan 16s ease-in-out infinite both;
    will-change: transform, opacity;
    /* Defaults; overridden by breakpoints below */
    --scale-start: 1.02;
    --scale-end: 1.14;
    --pan-x-start: 0;
    --pan-x-end: -2%;
    --pan-y-start: 0;
    --pan-y-end: 0;
    transform-origin: center center;
    backface-visibility: hidden;
  }

  @media (min-width: 1024px) { /* lg */
    .hero-zoom { --scale-end: 1.12; --pan-x-end: -1.2%; }
  }
  @media (min-width: 1280px) { /* xl */
    .hero-zoom { --scale-end: 1.14; --pan-x-end: -1.8%; }
  }
  @media (min-width: 1536px) { /* 2xl */
    .hero-zoom { --scale-end: 1.18; --pan-x-end: -2.5%; }
  }

  @media (prefers-reduced-motion: reduce) {
    .hero-zoom { animation: none; }
  }
</style>
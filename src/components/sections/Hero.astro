---
// Agracom Internacional S.A. - Hero Section Component
// Secci√≥n principal con propuesta de valor, CTAs y imagen hero

import type { Locale, Region, CTAButton, ImageAsset } from '../../types/global';
import { createTranslator } from '../../utils/i18n';

export interface Props {
  title?: string;
  subtitle?: string;
  description?: string;
  bgImage?: ImageAsset;
  primaryCTA?: CTAButton;
  secondaryCTA?: CTAButton;
  certificationBadges?: boolean;
  showStats?: boolean;
  region?: Region;
  lang: Locale;
  class?: string;
}

const {
  title,
  subtitle,
  description,
  bgImage,
  primaryCTA,
  // secondaryCTA,
  certificationBadges = true,
  showStats = true,
  region,
  lang,
  class: className = ''
} = Astro.props;

// Load translations
const { hero, common } = await createTranslator(lang);

// Default content from translations if not provided
const heroTitle = title || await hero('title');
const heroSubtitle = subtitle || await hero('subtitle');
const heroDescription = description || await hero('description');

// Default CTAs if not provided
const defaultPrimaryCTA: CTAButton = {
  text: primaryCTA?.text || await common('cta.inquire'),
  href: primaryCTA?.href || '#contacto',
  variant: primaryCTA?.variant || 'primary'
};

// Nota: CTA secundario original (descarga) no se usa en Hero; se reemplaza por explorar productos

// Stats data
const stats = [
  {
    value: '270+',
    label: lang === 'es' ? 'Embarques exitosos' : 'Successful shipments'
  },
  {
    value: '17',
    label: lang === 'es' ? 'Pa√≠ses' : 'Countries'
  },
  {
    value: '20+',
    label: lang === 'es' ? 'A√±os de experiencia' : 'Years of experience'
  }
];

// Certifications
const certifications = [
  { name: 'Kosher', class: 'certification-badge--kosher' },
  { name: 'Halal', class: 'certification-badge--halal' },
  { name: 'SAG', class: 'certification-badge--sag' }
];

// Default vertical hero image optimized for design (WebP)
const defaultHeroImage: ImageAsset = {
  src: '/images/agracom_herosection_bodegon.webp?v=1',
  alt: lang === 'es'
    ? 'Bodeg√≥n vertical de productos Agracom: lupinos, pasas y nueces'
    : 'Vertical still life of Agracom products: lupins, raisins and walnuts',
  width: 1200,
  height: 1800
};

// CTA secundario removido seg√∫n estrategia de foco en acci√≥n principal
---

<section 
  class={`section--hero bg-gradient-to-br from-primary/5 to-secondary/5 relative overflow-hidden mt-6 md:mt-8 lg:mt-10 ${className}`}
  role="banner"
  aria-label={lang === 'es' ? 'Secci√≥n principal' : 'Main hero section'}
>
  <!-- Background Pattern (Optional) -->
  <div class="absolute inset-0 opacity-5">
    <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KPGcgZmlsbD0iIzE1NjVDMCIgZmlsbC1vcGFjaXR5PSIwLjEiPgo8Y2lyY2xlIGN4PSIzMCIgY3k9IjMwIiByPSIyIi8+CjwvZz4KPC9nPgo8L3N2Zz4=')] repeat"></div>
  </div>

  <div class="container relative z-10">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-y-10 gap-x-12 items-start">
      <!-- Content Section -->
      <div class="lg:col-span-7 space-y-8 flex flex-col justify-start">
        <!-- Main Content -->
        <div class="space-y-6">
          <!-- Title -->
          <h1 
            class="text-h1 font-bold text-neutral-900 leading-tight tracking-tight max-w-3xl animate-fade-in"
            style="animation-delay: 0.1s"
            data-hero-title
          >
            {heroTitle}
          </h1>
          
          <!-- Subtitle -->
           <p 
            class="text-xl text-neutral-700 max-w-2xl leading-relaxed animate-fade-in"
            style="animation-delay: 0.2s"
             id="hero-subtitle"
          >
            {heroSubtitle}
          </p>

          <!-- Description (Optional) -->
          {heroDescription && (
            <p 
              class="text-lg text-neutral-600 max-w-xl animate-fade-in"
              style="animation-delay: 0.3s"
              data-hero-description
            >
              {heroDescription}
            </p>
          )}
          
          <!-- Certification Badges -->
          {certificationBadges && (
            <div 
              class="flex flex-wrap gap-3 animate-fade-in"
              style="animation-delay: 0.4s"
            >
              {certifications.map((cert) => (
                <span 
                  class={`certification-badge ${cert.class}`}
                  role="img"
                  aria-label={`${cert.name} certified`}
                >
                  {cert.name}
                </span>
              ))}
              
              <!-- Success metric badge -->
              <span 
                class="px-3 py-1 bg-accent bg-opacity-20 text-accent-dark rounded-full text-sm font-semibold border border-accent border-opacity-30"
              >
                270+ {lang === 'es' ? 'Embarques Exitosos' : 'Successful Shipments'}
              </span>
            </div>
          )}
        </div>
        
        <!-- CTA principal √∫nico -->
        <div 
          class="flex animate-fade-in"
          style="animation-delay: 0.5s"
        >
          <a 
            href={defaultPrimaryCTA.href}
            class={`btn btn-${defaultPrimaryCTA.variant} px-8 py-4 text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300`}
            onclick={`gtag && gtag('event', 'cta_click', { event_label: 'hero_primary', custom_parameter_region: '${region || 'unknown'}' })`}
          >
            {defaultPrimaryCTA.text}
            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>
        </div>

        <!-- Stats ahora se muestran a ancho completo, no dentro de la columna izquierda -->
      </div>
      
      <!-- Image Section -->
      <div 
        class="lg:col-span-5 relative animate-fade-in self-start"
        style="animation-delay: 0.3s"
      >
        <!-- Image Container (vertical-first) -->
        <div class="rounded-2xl shadow-2xl ring-1 ring-neutral-200 overflow-hidden bg-neutral-100 relative flex items-start justify-center w-full lg:max-w-[560px] xl:max-w-[600px] mx-auto">
          <picture class="block w-full">
            <source 
              srcset="/images/agracom_herosection_bodegon.webp?v=1 1200w, /images/agracom_herosection_bodegon.webp?v=1 800w, /images/agracom_herosection_bodegon.webp?v=1 600w" 
              sizes="(min-width: 1280px) 560px, (min-width: 1024px) 520px, 90vw" 
              type="image/webp" 
            />
            <img
              src={(bgImage?.src) || defaultHeroImage.src}
              alt={(bgImage?.alt) || defaultHeroImage.alt}
              width={(bgImage?.width) || defaultHeroImage.width}
              height={(bgImage?.height) || defaultHeroImage.height}
              loading="eager"
              decoding="async"
              fetchpriority="high"
              class="block w-auto h-auto max-h-[72vh] md:max-h-[78vh] object-cover mx-auto hero-zoom"
            />
          </picture>
          
          
        </div>

        
      </div>
    </div>

    <!-- Trust indicators -->
    <div 
      class="mt-16 text-center animate-fade-in"
      style="animation-delay: 0.7s"
    >
    <!-- Stats Section centrado a ancho completo -->
    {showStats && (
      <div class="container mb-12">
        <div class="grid grid-cols-3 gap-6 border-t border-neutral-200 pt-8">
          {stats.map((stat) => (
            <div class="text-center">
              <div 
                class="text-3xl md:text-4xl font-bold text-primary mb-1 counter"
                data-target={stat.value.replace(/\D/g, '')}
                data-suffix={stat.value.replace(/\d/g, '')}
              >
                {stat.value}
              </div>
              <div class="text-sm text-neutral-600 font-medium">
                {stat.label}
              </div>
            </div>
          ))}
        </div>
      </div>
    )}
      <p class="text-neutral-600 text-sm mb-4">
        {lang === 'es' 
          ? 'Confianza respaldada por certificaciones internacionales'
          : 'Trust backed by international certifications'
        }
      </p>
      <div class="flex justify-center items-center space-x-8 opacity-60">
        {/* Certification logos would go here when available */}
        <div class="text-2xl">üèÜ</div>
        <div class="text-2xl">‚úÖ</div>
        <div class="text-2xl">üåç</div>
        <div class="text-2xl">üìã</div>
      </div>
    </div>
  </div>
</section>

<!-- JavaScript for animations and interactions -->
<script>
  // Counter animation for stats
  function animateCounters() {
    const counters = document.querySelectorAll('.counter') as NodeListOf<HTMLElement>;
    
    counters.forEach(counter => {
      const target = parseInt((counter as HTMLElement).dataset.target || '0');
      const suffix = (counter as HTMLElement).dataset.suffix || '';
      const duration = 2000; // 2 seconds
      const increment = target / (duration / 16); // 60fps
      let current = 0;
      
      const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
          current = target;
          clearInterval(timer);
        }
        (counter as HTMLElement).textContent = Math.floor(current) + suffix;
      }, 16);
    });
  }

  // Intersection Observer for animations
  function observeHero() {
    const hero = document.querySelector('section[role="banner"]');
    if (!hero) return;

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          // Trigger counter animation when hero comes into view
          setTimeout(animateCounters, 800);
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.3 });

    observer.observe(hero);
  }

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    observeHero();
  });

  // (Optional) Parallax effect removed to avoid unused function lint errors
</script>

<style>
  /* Custom animations */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fadeIn 0.8s ease-out forwards;
    opacity: 0;
  }

  /* Enhanced button hover effects */
  .btn:hover {
    transform: translateY(-2px);
  }

  .btn:active {
    transform: translateY(0);
  }

  /* Ensure hero takes appropriate height */
  .section--hero { min-height: 78vh; display: flex; align-items: center; }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .section--hero {
      min-height: 70vh;
    }
    
    .hero-container {
      gap: 2rem;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .certification-badge {
      border: 2px solid currentColor;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .animate-fade-in {
      animation: none;
      opacity: 1;
    }
    
    .btn:hover {
      transform: none;
    }
  }

  /* === Hero image subtle zoom loop === */
  @keyframes heroZoomPan {
    /* Inicio del ciclo: aparece sutilmente mientras comienza el acercamiento */
    0%   { transform: translate(var(--pan-x-start, 0), var(--pan-y-start, 0)) scale(var(--scale-start, 1.02)); opacity: 0; }
    3%   { transform: translate(var(--pan-x-start, 0), var(--pan-y-start, 0)) scale(var(--scale-start, 1.02)); opacity: 1; }
    /* Zoom + pan principal */
    70%  { transform: translate(var(--pan-x-end, -2%), var(--pan-y-end, 0)) scale(var(--scale-end, 1.14)); opacity: 1; }
    /* Pausa en m√°ximo zoom (‚âà2s en ciclo de 16s) */
    90%  { transform: translate(var(--pan-x-end, -2%), var(--pan-y-end, 0)) scale(var(--scale-end, 1.14)); opacity: 1; }
    /* Desvanecer para cerrar el ciclo, sin retroceder zoom */
    100% { transform: translate(var(--pan-x-end, -2%), var(--pan-y-end, 0)) scale(var(--scale-end, 1.14)); opacity: 0; }
  }

  .hero-zoom {
    animation: heroZoomPan 16s ease-in-out infinite both;
    will-change: transform, opacity;
    /* Defaults; overridden by breakpoints below */
    --scale-start: 1.02;
    --scale-end: 1.14;
    --pan-x-start: 0;
    --pan-x-end: -2%;
    --pan-y-start: 0;
    --pan-y-end: 0;
    transform-origin: center center;
    backface-visibility: hidden;
  }

  @media (min-width: 1024px) { /* lg */
    .hero-zoom { --scale-end: 1.12; --pan-x-end: -1.2%; }
  }
  @media (min-width: 1280px) { /* xl */
    .hero-zoom { --scale-end: 1.14; --pan-x-end: -1.8%; }
  }
  @media (min-width: 1536px) { /* 2xl */
    .hero-zoom { --scale-end: 1.18; --pan-x-end: -2.5%; }
  }

  @media (prefers-reduced-motion: reduce) {
    .hero-zoom { animation: none; }
  }
</style>